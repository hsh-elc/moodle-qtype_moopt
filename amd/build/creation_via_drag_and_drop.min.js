function setSelectionSafely(query){select=document.querySelector(query),null!==select&&(select.selected=!0)}function enterKeyEvent(elem){var event=new KeyboardEvent("keydown",{bubbles:!0,cancelBubble:!1,cancelable:!0,charCode:0,code:"Enter",isTrusted:!0,key:"Enter",keyCode:13,repeat:!1,type:"keydown",which:13});elem.dispatchEvent(event)}define("qtype_moopt/creation_via_drag_and_drop",["core/ajax","qtype_moopt/edit_editor_content"],(function(ajax,editorEditor){return{init:function(availableGraders){var self=this;document.querySelector("#loadproformataskfilebutton").addEventListener("click",(function(){self.extractInformation(availableGraders)}))},extractInformation:function(){var fileManager=document.querySelector("#id_proformataskfileupload").parentNode,itemId=null;fileManager.childNodes.forEach((function(child){"proformataskfileupload"==child.name&&null===itemId&&(itemId=child.value)})),ajax.call([{methodname:"qtype_moopt_extract_task_infos_from_draft_file",args:{itemid:itemId},done:function(result){if(void 0!==result.error)return document.querySelector("#id_error_ajaxerrorlabel").parentNode.children.item(0).innerHTML="<div>"+result.error+"</div>",void(document.querySelector("#id_error_ajaxwarnlabel").parentNode.children.item(0).innerHTML="");document.querySelector("#id_error_ajaxerrorlabel").parentNode.children.item(0).innerHTML="",document.querySelector("#id_name").value=result.title,editorEditor.setContents("id_questiontext",result.description),editorEditor.setContents("id_internaldescription",result.internaldescription),editorEditor.setContents("id_taskuuid",result.taskuuid),editorEditor.setContents("id_defaultmark",result.maxscoregradinghints),editorEditor.setContents("id_generalfeedback",result.filesdisplayedingeneralfeedback),ajax.call([{methodname:"qtype_moopt_get_grader_data",args:{},done:function(availableGraders){if(availableGraders.length>0){let selectedGrader=availableGraders[0],e=document.querySelector("#id_graderselect"),alreadySelectedGraderIDHtmlRepresentation=e.options[e.selectedIndex].value;for(let i=0;i<availableGraders.length;i++){if(availableGraders[i].html_representation===alreadySelectedGraderIDHtmlRepresentation){selectedGrader=availableGraders[i];break}}const supportedGraders=[];if(availableGraders.forEach((function(grader){if("proglangs"in grader)for(let i=0;i<grader.proglangs.length;i++)if(grader.proglangs[i].toLowerCase()===result.proglang.toLowerCase()){supportedGraders.push(grader);break}})),supportedGraders.length>0){const supportedGradersWithSameName=[],firstName=supportedGraders[0].name;if(supportedGraders.forEach((function(grader){grader.name===firstName&&supportedGradersWithSameName.push(grader)})),supportedGradersWithSameName.length>0){selectedGrader=supportedGradersWithSameName[0];for(let k=1;k<supportedGradersWithSameName.length;k++){const versionNumDigits=supportedGradersWithSameName[k].version.split("."),maxVersionNumDigits=selectedGrader.version.split(".");for(let i=0;i<Math.max(versionNumDigits.length,maxVersionNumDigits.length);i++){let versionNumber=parseInt(versionNumDigits[i]);isNaN(versionNumber)&&(versionNumber=-1);let maxVersionNumber=parseInt(maxVersionNumDigits[i]);if(isNaN(maxVersionNumber)&&(maxVersionNumber=-1),versionNumber>maxVersionNumber){selectedGrader=supportedGradersWithSameName[k];break}if(versionNumber<maxVersionNumber)break}}}}let searchVal=selectedGrader.html_representation;setSelectionSafely("#id_graderselect option[value='"+searchVal+"']");let tagInput=document.querySelectorAll("[id^=form_autocomplete_input]")[0];tagInput.value=result.proglang,enterKeyEvent(tagInput);let gradername=document.querySelector("#id_graderselect option[value='"+searchVal+"']").text;tagInput.value=gradername,enterKeyEvent(tagInput),tagInput.value="MooPT",enterKeyEvent(tagInput),"result_spec"in selectedGrader&&("format"in selectedGrader.result_spec&&(searchVal=selectedGrader.result_spec.format,setSelectionSafely("#id_resultspecformat option[value='"+searchVal+"']")),"structure"in selectedGrader.result_spec&&(searchVal=selectedGrader.result_spec.structure,setSelectionSafely("#id_resultspecstructure option[value='"+searchVal+"']")),"teacher_feedback_level"in selectedGrader.result_spec&&(searchVal=selectedGrader.result_spec.teacher_feedback_level,setSelectionSafely("#id_teacherfeedbacklevel option[value='"+searchVal+"']")),"student_feedback_level"in selectedGrader.result_spec&&(searchVal=selectedGrader.result_spec.student_feedback_level,setSelectionSafely("#id_studentfeedbacklevel option[value='"+searchVal+"']")))}}}]);let elem=document.querySelector("#id_enablefilesubmissions");elem.checked=!result.enablefileinput,elem.click();let ftsmaxnumfields=result.freetextfilesettings.length;if(elem=document.querySelector("#id_enablefreetextsubmissions"),elem.checked=!(ftsmaxnumfields>0),elem.click(),ftsmaxnumfields>0){elem=document.querySelector("#id_ftsnuminitialfields"),elem.value=ftsmaxnumfields,elem.click(),elem=document.querySelector("#id_ftsmaxnumfields"),elem.value=ftsmaxnumfields,elem.click(),elem.dispatchEvent(new Event("change")),elem=document.querySelector("#id_ftsstandardlang");let options=elem.options;for(let i=0;i<options.length;i++)options[i].text.toLowerCase()===result.proglang.toLowerCase()&&(elem.selectedIndex=i);elem=document.querySelector("#id_enablecustomsettingsforfreetextinputfields"),elem.checked=!1,elem.click();for(let i=0;i<result.freetextfilesettings.length;i++)elem=document.querySelector("#id_enablecustomsettingsforfreetextinputfield"+i),elem.checked=!result.freetextfilesettings[i].enablecustomsettings,elem.click(),1==result.freetextfilesettings[i].usefixedfilename?(elem=document.querySelector("#id_namesettingsforfreetextinput"+i+"_0"),elem.checked=!1,elem.click()):(elem=document.querySelector("#id_namesettingsforfreetextinput"+i+"_1"),elem.checked=!1,elem.click()),document.querySelector("#id_freetextinputfieldname"+i).value=result.freetextfilesettings[i].defaultfilename,document.querySelector("#id_freetextinputfieldtemplate"+i).value=result.freetextfilesettings[i].filecontent,document.querySelector("#id_ftsoverwrittenlang"+i).value=result.freetextfilesettings[i].proglang,document.querySelector("#id_ftsinitialdisplayrows"+i).value=result.freetextfilesettings[i].initialdisplayrows}let warnings="";void 0!==result.moodleValidationProformaNamespace&&(warnings+="<p>Detected ProFormA-version "+result.moodleValidationProformaNamespace+"</p>"),void 0!==result.moodleValidationWarningInvalidNamespace&&(warnings+="<p>"+result.moodleValidationWarningInvalidNamespace+"</p>"),void 0!==result.moodleValidationWarnings&&(warnings+="<p>Found the following problems during validation but still continued:</p><ul>",result.moodleValidationWarnings.forEach((function(e){warnings+="<li>"+e.msg+"</li>"})),warnings+="</ul>"),document.querySelector("#id_error_ajaxwarninglabel").parentNode.children.item(0).innerHTML=warnings,document.querySelector("#loadproformataskfilebutton").focus()},fail:function(errorObject){console.log(errorObject),document.querySelector("#id_error_ajaxerrorlabel").parentNode.children.item(0).innerHTML="<div>"+errorObject.debuginfo+"</div><div> For more information see browser console.</div>",document.querySelector("#id_error_ajaxwarninglabel").parentNode.children.item(0).innerHTML=""}}])}}}));

//# sourceMappingURL=creation_via_drag_and_drop.min.js.map